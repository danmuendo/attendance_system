<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Teacher Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
/* Global */
* { box-sizing: border-box; }

body { font-family: Arial, sans-serif; margin:0; background: #f4f6f8; }

/* Sidebar */
.sidebar {
    height: 100vh;
    width: 220px;
    position: fixed;
    top: 0;
    left: 0;
    background-color: #2c7be5;
    color: white;
    display: flex;
    flex-direction: column;
    padding: 20px;
}

.sidebar h2 { margin-top:0; margin-bottom:20px; font-size:20px; }

.sidebar button {
    background: white;
    color: #2c7be5;
    border: none;
    border-radius: 8px;
    padding: 12px 15px;
    margin-bottom: 12px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    text-align: left;
    transition: 0.3s;
    display: flex;
    align-items: center;
    box-shadow: 0 3px 6px rgba(0,0,0,0.1);
}

.sidebar button:hover { background: #e0e7ff; }
.sidebar button.danger { color:white; background:#d32f2f; }
.sidebar button.danger:hover { background:#b71c1c; }
.sidebar button i { margin-right: 10px; }

/* Main */
.main { margin-left:240px; padding:20px 30px; }
h1 { margin-top:0; }

/* Sections */
.section { display:none; margin-top:20px; }

/* Cards */
.card { background:white; padding:20px; border-radius:10px; margin-bottom:20px; box-shadow:0 4px 8px rgba(0,0,0,0.1); }

/* Overview cards */
.overview-cards { display:flex; flex-wrap:wrap; gap:20px; }
.overview-card { flex:1 1 200px; padding:20px; border-radius:10px; color:white; font-weight:bold; box-shadow:0 3px 6px rgba(0,0,0,0.1); }
.students { background:#2c7be5; }
.records { background:#17a2b8; color:#fff; }
.latest { background:#ffc107; color:#333; }

/* Tables */
.table-card { overflow-x:auto; }
table { width:100%; border-collapse:collapse; margin-top:10px; }
th, td { padding:12px; border-bottom:1px solid #ddd; text-align:left; }
th { background:#2c7be5; color:white; }
tr:nth-child(even){ background:#f9f9f9; }

/* Buttons */
.button {
    display: inline-block;
    margin: 5px 5px 5px 0;
    padding: 12px 20px;
    background: #2c7be5;
    color: white;
    border-radius: 8px;
    text-decoration: none;
    font-weight: bold;
    font-size: 16px;
    border: none;
    cursor: pointer;
    box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    transition: 0.3s;
}

.button:hover {
    background: #1a5dc7;
    box-shadow: 0 5px 10px rgba(0,0,0,0.15);
}

.button.danger {
    background: #d32f2f;
}

.button.danger:hover {
    background: #b71c1c;
}

/* Stats */
.stats-box { display:flex; flex-wrap:wrap; gap:20px; }
.stats-card { flex:1 1 200px; background:#17a2b8; color:white; padding:20px; border-radius:10px; font-weight:bold; box-shadow:0 3px 6px rgba(0,0,0,0.1); }

/* Mobile */
@media(max-width:768px){
    .sidebar{width:100%; height:auto; position:relative;}
    .main{margin-left:0; padding:20px 15px;}
    .overview-cards, .stats-box{flex-direction:column;}
}
</style>
</head>
<body>

<div class="sidebar">
    <h2>üìä Dashboard</h2>
    <button onclick="showSection('overview')"><i>üìå</i> Overview</button>
    <button onclick="showSection('all')"><i>üìã</i> All Attendance</button>
    <button onclick="showSection('students')"><i>üë®‚Äçüéì</i> Students</button>
    <button onclick="showSection('generate')"><i>üñºÔ∏è</i> Generate QR</button>
    <button onclick="showSection('export')"><i>üì•</i> Export Excel</button>
    <button onclick="showSection('clear')" class="danger"><i>üóëÔ∏è</i> Clear Today</button>
    <button onclick="showSection('stats')"><i>üìä</i> Stats</button>
    <button onclick="window.location='/logout'"><i>üö™</i> Logout</button>
</div>

<div class="main">
    <h1>Teacher Dashboard</h1>
    <p>Date: <strong>{{ today }}</strong></p>

    <!-- OVERVIEW -->
    <div id="overview" class="section">
        <div class="overview-cards">
            <div class="overview-card students">
                <h3>Today's Students</h3>
                <p style="font-size:24px;">{{ today_records|length }}</p>
            </div>
            <div class="overview-card records">
                <h3>Total Records</h3>
                <p style="font-size:24px;">{{ all_records|length }}</p>
            </div>
            <div class="overview-card latest">
                <h3>Latest 5 Entries</h3>
                <ul>
                    {% for name, time in today_records[-5:] %}
                        <li>{{ name }} - {{ time }}</li>
                    {% else %}
                        <li>No attendance yet</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

    <!-- ALL ATTENDANCE -->
    <div id="all" class="section">
        <div class="card table-card">
            <h2>All Attendance Records</h2>
            <table>
                <tr><th>Name</th><th>Date</th><th>Time</th></tr>
                {% for name, date, time in all_records %}
                <tr><td>{{ name }}</td><td>{{ date }}</td><td>{{ time }}</td></tr>
                {% endfor %}
            </table>
        </div>
    </div>

    <!-- STUDENTS -->
<div id="students" class="section">
    <div class="card">
        <h2>Manage Students</h2>

        <form method="POST" action="/students" style="margin-bottom:20px;">
            <input name="name" placeholder="Student name" required
                   style="padding:10px;width:250px;border-radius:6px;border:1px solid #ccc;">
            <button class="button" type="submit">‚ûï Add Student</button>
        </form>

        <table>
            <tr><th>ID</th><th>Name</th></tr>
            {% for s in students %}
            <tr>
                <td>{{ s[0] }}</td>
                <td>{{ s[1] }}</td>
            </tr>
            {% endfor %}
        </table>

    </div>
</div>

    <!-- GENERATE QR -->
    <div id="generate" class="section">
        <div class="card">
            <h2>Generate QR Code</h2>
            <div class="actions">
                <a href="/generate" class="button">Generate QR</a>
            </div> -->

            <!-- QR image
            <div id="qr-print" style="margin-top:20px; text-align:center;">
                <img id="qr-image" src="/static/qr.png" alt="QR Code">
            </div>

            <!-- Download QR below image -->
            <div style="margin-top:10px; text-align:center;">
                <a id="download-qr" href="/static/qr.png" download="attendance_qr.png" class="button">üíæ Download QR Code</a>
            </div>
        </div>
    </div>

    <!-- EXPORT -->
    <div id="export" class="section">
        <div class="card">
            <h2>Export Attendance</h2>
            <a href="/export" class="button">üì• Download Excel</a>
        </div>
    </div>

    <!-- CLEAR -->
    <div id="clear" class="section">
        <div class="card">
            <h2>Clear Today's Attendance</h2>
            <a href="/clear_today" class="button danger">üóëÔ∏è Clear Today</a>
        </div>
    </div>

    <!-- STATS -->
    <div id="stats" class="section">
        <div class="stats-box">
            <div class="stats-card">
                <h3>Today's Attendance</h3>
                <p style="font-size:24px;">{{ today_records|length }}</p>
            </div>
            <div class="stats-card">
                <h3>Total Records</h3>
                <p style="font-size:24px;">{{ all_records|length }}</p>
            </div>
            <div class="stats-card">
                <h3>Attendance % Today</h3>
                {% set percent = (today_records|length / (all_records|length if all_records|length>0 else 1)*100) | round(1) %}
                <p style="font-size:24px;">{{ percent }}%</p>
            </div>
        </div>
    </div>

</div>

<script>
// Toggle sections
function showSection(id){
    document.querySelectorAll('.section').forEach(s=>s.style.display='none');
    document.getElementById(id).style.display='block';
}

// Show overview by default
showSection('overview');
</script>

</body>
</html>
