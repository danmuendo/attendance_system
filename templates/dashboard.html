<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Teacher Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
/* --- SAME CSS AS YOUR FILE (UNCHANGED) --- */
* { box-sizing: border-box; }
body { font-family: Arial, sans-serif; margin:0; background: #f4f6f8; }
.sidebar {
    height: 100vh;
    width: 220px;
    position: fixed;
    top: 0;
    left: 0;
    background-color: #2c7be5;
    color: white;
    display: flex;
    flex-direction: column;
    padding: 20px;
}
.sidebar h2 { margin-top:0; margin-bottom:20px; font-size:20px; }
.sidebar button {
    background: white;
    color: #2c7be5;
    border: none;
    border-radius: 8px;
    padding: 12px 15px;
    margin-bottom: 12px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    text-align: left;
    display: flex;
    align-items: center;
}
.sidebar button.danger { background:#d32f2f; color:white; }
.main { margin-left:240px; padding:20px 30px; }
.section { display:none; margin-top:20px; }
.card { background:white; padding:20px; border-radius:10px; margin-bottom:20px; }
.button {
    padding:12px 20px;
    background:#2c7be5;
    color:white;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-weight:bold;
}
.button.danger { background:#d32f2f; }
</style>
</head>

<body>

<div class="sidebar">
    <h2>ğŸ“Š Dashboard</h2>
    <button onclick="showSection('overview')">ğŸ“Œ Overview</button>
    <button onclick="showSection('all')">ğŸ“‹ All Attendance</button>
    <button onclick="showSection('students')">ğŸ‘¨â€ğŸ“ Students</button>
    <button onclick="showSection('generate')">ğŸ–¼ï¸ Generate QR</button>
    <button onclick="showSection('export')">ğŸ“¥ Export Excel</button>
    <button onclick="showSection('clear')" class="danger">ğŸ—‘ï¸ Clear Today</button>
    <button onclick="window.location='{{ url_for('logout') }}'">ğŸšª Logout</button>
</div>

<div class="main">
<h1>Teacher Dashboard</h1>
<p>Date: <strong>{{ today }}</strong></p>

<!-- OVERVIEW -->
<div id="overview" class="section">
    <div class="card">
        <h3>Today's Attendance</h3>
        <p style="font-size:24px;">{{ today_records|length }}</p>
    </div>
</div>

<!-- ALL ATTENDANCE -->
<div id="all" class="section">
    <div class="card">
        <h2>All Attendance</h2>
        <table width="100%">
            <tr><th>Name</th><th>Date</th><th>Time</th></tr>
            {% for name, date, time in all_records %}
            <tr><td>{{ name }}</td><td>{{ date }}</td><td>{{ time }}</td></tr>
            {% endfor %}
        </table>
    </div>
</div>

<!-- STUDENTS -->
<div id="students" class="section">
    <div class="card">
        <h2>Manage Students</h2>

        <form method="POST" action="{{ url_for('manage_students') }}">
            <input name="name" placeholder="Student name" required>
            <button class="button">â• Add Student</button>
        </form>

        <table width="100%" style="margin-top:15px;">
            <tr><th>ID</th><th>Name</th></tr>
            {% for s in students %}
            <tr><td>{{ s[0] }}</td><td>{{ s[1] }}</td></tr>
            {% endfor %}
        </table>
    </div>
</div>

<!-- GENERATE QR -->
<div id="generate" class="section">
    <div class="card" style="text-align:center;">
        <h2>Generate Attendance QR</h2>

        <!-- âœ… FIX: GENERATE BUTTON -->
        <a href="{{ url_for('generate_qr') }}" class="button">ğŸ–¼ï¸ Generate QR Code</a>

        {% if qr_exists %}
            <div style="margin-top:20px;">
                <img src="{{ url_for('static', filename='qr.png') }}" width="220">
            </div>

            <div style="margin-top:10px;">
                <a href="{{ url_for('static', filename='qr.png') }}"
                   download="attendance_qr.png"
                   class="button">ğŸ’¾ Download QR</a>
            </div>
        {% else %}
            <p style="margin-top:20px;">No QR generated yet.</p>
        {% endif %}
    </div>
</div>

<!-- EXPORT -->
<div id="export" class="section">
    <div class="card">
        <a href="{{ url_for('export_excel') }}" class="button">ğŸ“¥ Download Excel</a>
    </div>
</div>

<!-- CLEAR -->
<div id="clear" class="section">
    <div class="card">
        <a href="{{ url_for('clear_today') }}" class="button danger">ğŸ—‘ï¸ Clear Today</a>
    </div>
</div>

</div>

<script>
function showSection(id){
    document.querySelectorAll('.section').forEach(s=>s.style.display='none');
    document.getElementById(id).style.display='block';
}
showSection('overview');
</script>

</body>
</html>
